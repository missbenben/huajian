self.onmessage = function (e) {
    var category;
    var cateInfo = JSON.parse(e.data);
    var url = cateInfo.url;
    var formData = new FormData();
    formData.append('ProjectID', cateInfo.ProjectID);
    formData.append('ModelID', cateInfo.ModelID);
    formData.append('VersionNO', cateInfo.VersionNO);
    formData.append('Levels', cateInfo.Levels);
    formData.append('BaseViewID', cateInfo.BaseViewID);
    formData.append('CategoryID', cateInfo.CategoryID);
    postJSON(url, formData).then(function (data) {
        var geoCategory = [];
        var elementMesh = [];
        var rawCategory = JSON.parse(data);
        for (var _i = 0, _a = rawCategory.Blocks; _i < _a.length; _i++) {
            var block = _a[_i];
            var ctm = block.Content.toString();
            var ctmArr = decode(ctm);
            var geo = {
                blockId: block.ID,
                content: ctmArr,
            };
            geoCategory.push(geo);
        }
        var category = {
            modelIdAndViewId: cateInfo.ModelID + '^' + cateInfo.BaseViewID,
            geometries: geoCategory,
            batchName: rawCategory.BatchName,
            elements: rawCategory.Elements
        };
        data = null;
        var msg = { obj: category };
        self.postMessage(msg);
    });
};
function postJSON(_url, _formData) {
    return new Promise(function (resolve, reject) {
        var request = new XMLHttpRequest();
        request.open('POST', _url, true);
        request.onreadystatechange = function () {
            if (this.readyState === 4 && (this.status === 200 || this.status === 0)) {
                try {
                    if (request.responseText.indexOf('schemas.microsoft.com') >= 0) {
                        var parser = new DOMParser();
                        var resultDoc = parser.parseFromString(request.responseText, 'text/xml');
                        var resText = request.responseText.split('Serialization/">')[1].split('</string')[0];
                        resolve(resText);
                    }
                    else {
                        resolve(request.responseText);
                    }
                }
                catch (e) {
                    reject({
                        e: e,
                        url: _url
                    });
                }
            }
        };
        request.send(_formData);
    });
}
function Str2Bytes(str) {
    var pos = 0;
    var len = str.length;
    if (len % 2 !== 0) {
        return null;
    }
    len /= 2;
    var hexA = new Array();
    for (var i = 0; i < len; i++) {
        var s = str.substr(pos, 2);
        var v = parseInt(s, 16);
        hexA.push(v);
        pos += 2;
    }
    return hexA;
}
function decode(input) {
    var _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    var output = '';
    var chr1, chr2, chr3;
    var enc1, enc2, enc3, enc4;
    var i = 0;
    input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');
    while (i < input.length) {
        enc1 = _keyStr.indexOf(input.charAt(i++));
        enc2 = _keyStr.indexOf(input.charAt(i++));
        enc3 = _keyStr.indexOf(input.charAt(i++));
        enc4 = _keyStr.indexOf(input.charAt(i++));
        chr1 = (enc1 << 2) | (enc2 >> 4);
        chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
        chr3 = ((enc3 & 3) << 6) | enc4;
        output = output + String.fromCharCode(chr1);
        if (enc3 !== 64) {
            output = output + String.fromCharCode(chr2);
        }
        if (enc4 !== 64) {
            output = output + String.fromCharCode(chr3);
        }
    }
    return output;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmtzL2JpbS9zZXJ2aWNlcy93ZWJXb3JrZXItc2NlbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBMEJBLElBQUksQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDO0lBQzFCLElBQUksUUFBYSxDQUFDO0lBQ2xCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xDLElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUM7SUFDdkIsSUFBSSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztJQUM5QixRQUFRLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDakQsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzdDLFFBQVEsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqRCxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0MsUUFBUSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ25ELFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNuRCxRQUFRLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLElBQUk7UUFDaEMsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQVcsQ0FBQyxDQUFDO1FBQzFDLEdBQUcsQ0FBQyxDQUFjLFVBQWtCLEVBQWxCLEtBQUEsV0FBVyxDQUFDLE1BQU0s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RyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN4QyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDaEMsTUFBTSxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLE1BQU0sR0FBRyxNQUFNLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEIsTUFBTSxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNoQixDQUFDIiwiZmlsZSI6ImFwcC9mcmFtZXdvcmtzL2JpbS9zZXJ2aWNlcy93ZWJXb3JrZXItc2NlbmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL+eUqOadpeWkhOeQhuWkmue6v+eoi+mXrumimFxuLy8gKHNlbGYgYXMgYW55KS5pbXBvcnRTY3JpcHRzKCdodHRwOi8vbG9jYWxob3N0OjU1NTUvbm9kZV9tb2R1bGVzL3RocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvY3RtLy9jdG0uanMnKTtcbi8vIChzZWxmIGFzIGFueSkuaW1wb3J0U2NyaXB0cygnaHR0cDovL2xvY2FsaG9zdDo1NTU1L25vZGVfbW9kdWxlcy90aHJlZS9leGFtcGxlcy9qcy9sb2FkZXJzL2N0bS8vbHptYS5qcycpO1xuLy8gKHNlbGYgYXMgYW55KS5pbXBvcnRTY3JpcHRzKCdodHRwOi8vbG9jYWxob3N0OjU1NTUvbm9kZV9tb2R1bGVzL3RocmVlL2V4YW1wbGVzL2pzLy9odG1sNS1mb3JtZGF0YS1wb2x5ZmlsbGwuanMnKTtcbmRlY2xhcmUgdmFyIENUTTtcblxudHlwZSBFbGVtZW50VHlwZSA9IHtcbiAgbW9kZWxJZDogc3RyaW5nLFxuICBiYXRjaEluZGV4OiBudW1iZXIsXG4gIGJhdGNoTmFtZTogc3RyaW5nLFxuICBzY2VuZUluZGV4OiBudW1iZXIsXG4gIGZhbWlseUlkOiBzdHJpbmcsXG4gIGZhbWlseU5hbWU6IHN0cmluZyxcbiAgbGV2ZWxJZDogc3RyaW5nLFxuICB0eXBlSWQ6IHN0cmluZyxcbiAgdHlwZU5hbWU6IHN0cmluZyxcbiAgdHJhbnNmb3JtOiBzdHJpbmcsXG4gIGVsZW1lbnRJZDogbnVtYmVyLFxuICBoYXNCcm90aGVyczogYm9vbGVhbixcbiAgcHJvcGVydGllczogYW55O1xuICBoYXNUcmFuc3BhcmVudDogYm9vbGVhbixcbiAgZ2VvbWV0cnlQb3NpdGlvbjogc3RyaW5nLFxuICBtYXRlcmlhbElkOiBzdHJpbmcsXG4gIHBhcnRzOiBhbnlbXVxufTtcblxuc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuICBsZXQgY2F0ZWdvcnk6IGFueTtcbiAgbGV0IGNhdGVJbmZvID0gSlNPTi5wYXJzZShlLmRhdGEpO1xuICBsZXQgdXJsID0gY2F0ZUluZm8udXJsO1xuICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgZm9ybURhdGEuYXBwZW5kKCdQcm9qZWN0SUQnLCBjYXRlSW5mby5Qcm9qZWN0SUQpO1xuICBmb3JtRGF0YS5hcHBlbmQoJ01vZGVsSUQnLCBjYXRlSW5mby5Nb2RlbElEKTtcbiAgZm9ybURhdGEuYXBwZW5kKCdWZXJzaW9uTk8nLCBjYXRlSW5mby5WZXJzaW9uTk8pO1xuICBmb3JtRGF0YS5hcHBlbmQoJ0xldmVscycsIGNhdGVJbmZvLkxldmVscyk7XG4gIGZvcm1EYXRhLmFwcGVuZCgnQmFzZVZpZXdJRCcsIGNhdGVJbmZvLkJhc2VWaWV3SUQpO1xuICBmb3JtRGF0YS5hcHBlbmQoJ0NhdGVnb3J5SUQnLCBjYXRlSW5mby5DYXRlZ29yeUlEKTtcbiAgcG9zdEpTT04odXJsLCBmb3JtRGF0YSkudGhlbigoZGF0YSkgPT4ge1xuICAgIGxldCBnZW9DYXRlZ29yeSA9IFtdO1xuICAgIGxldCBlbGVtZW50TWVzaCA9IFtdO1xuICAgIGxldCByYXdDYXRlZ29yeSA9IEpTT04ucGFyc2UoZGF0YSBhcyBhbnkpO1xuICAgIGZvciAobGV0IGJsb2NrIG9mIHJhd0NhdGVnb3J5LkJsb2Nrcykge1xuXG4gICAgICBsZXQgY3RtID0gYmxvY2suQ29udGVudC50b1N0cmluZygpO1xuICAgICAgICAgICAgICBsZXQgY3RtQXJyID0gZGVjb2RlKGN0bSk7XG4gICAgICAvLyBjdG0gPSAnJztcbiAgICAgIC8vIGZvciAobGV0IGluZGV4IG9mIGN0bUFycikge1xuICAgICAgLy8gICBsZXQgY2hhcmNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGluZGV4KSk7XG4gICAgICAvLyAgIGN0bSArPSBjaGFyY29kZTtcbiAgICAgIC8vIH1cbiAgICAgIC8vIGxldCBmaWxlID0gbmV3IENUTS5GaWxlKG5ldyBDVE0uU3RyZWFtKGN0bSkpO1xuICAgICAgLy8gZ2VvQ2F0ZWdvcnkuc2V0KGJsb2NrLklELCBjcmVhdGVHZW9tZXRyeUZyb21DVE0oZmlsZSkpO1xuICAgICAgbGV0IGdlbyA9IHtcbiAgICAgICAgYmxvY2tJZDogYmxvY2suSUQsXG4gICAgICAgIGNvbnRlbnQ6IGN0bUFyciwvL2NyZWF0ZUdlb21ldHJ5RnJvbUNUTShmaWxlKSxcbiAgICAgIH07XG4gICAgICBnZW9DYXRlZ29yeS5wdXNoKGdlbyk7XG4gICAgfVxuICAgIGxldCBjYXRlZ29yeSA9IHtcbiAgICAgIG1vZGVsSWRBbmRWaWV3SWQ6IGNhdGVJbmZvLk1vZGVsSUQgKyAnXicgKyBjYXRlSW5mby5CYXNlVmlld0lELFxuICAgICAgZ2VvbWV0cmllczogZ2VvQ2F0ZWdvcnksXG4gICAgICBiYXRjaE5hbWU6IHJhd0NhdGVnb3J5LkJhdGNoTmFtZSxcbiAgICAgIGVsZW1lbnRzOiByYXdDYXRlZ29yeS5FbGVtZW50c1xuICAgIH07XG4gICAgZGF0YSA9IG51bGw7XG4gICAgbGV0IG1zZyA9IHtvYmo6IGNhdGVnb3J5fTtcbiAgICAoc2VsZiBhcyBhbnkpLnBvc3RNZXNzYWdlKG1zZyk7XG4gIH0pO1xuXG59O1xuXG4vL3Bvc3RcbmZ1bmN0aW9uIHBvc3RKU09OKF91cmwsIF9mb3JtRGF0YSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgcmVxdWVzdC5vcGVuKCdQT1NUJywgX3VybCwgdHJ1ZSk7XG4gICAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmICh0aGlzLnN0YXR1cyA9PT0gMjAwIHx8IHRoaXMuc3RhdHVzID09PSAwKSkge1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKHJlcXVlc3QucmVzcG9uc2VUZXh0LmluZGV4T2YoJ3NjaGVtYXMubWljcm9zb2Z0LmNvbScpID49IDApIHtcbiAgICAgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgICAgICB2YXIgcmVzdWx0RG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhyZXF1ZXN0LnJlc3BvbnNlVGV4dCwgJ3RleHQveG1sJyk7XG4gICAgICAgICAgICB2YXIgcmVzVGV4dCA9IHJlcXVlc3QucmVzcG9uc2VUZXh0LnNwbGl0KCdTZXJpYWxpemF0aW9uL1wiPicpWzFdLnNwbGl0KCc8L3N0cmluZycpWzBdO1xuICAgICAgICAgICAgcmVzb2x2ZShyZXNUZXh0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG5cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgZTogZSxcbiAgICAgICAgICAgIHVybDogX3VybFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICByZXF1ZXN0LnNlbmQoX2Zvcm1EYXRhKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIFN0cjJCeXRlcyhzdHIpIHtcbiAgbGV0IHBvcyA9IDA7XG4gIGxldCBsZW4gPSBzdHIubGVuZ3RoO1xuICBpZiAobGVuICUgMiAhPT0gMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGxlbiAvPSAyO1xuICBsZXQgaGV4QSA9IG5ldyBBcnJheSgpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgbGV0IHMgPSBzdHIuc3Vic3RyKHBvcywgMik7XG4gICAgbGV0IHYgPSBwYXJzZUludChzLCAxNik7XG4gICAgaGV4QS5wdXNoKHYpO1xuICAgIHBvcyArPSAyO1xuICB9XG4gIHJldHVybiBoZXhBO1xufVxuXG5mdW5jdGlvbiBkZWNvZGUoaW5wdXQpIHtcbiAgbGV0IF9rZXlTdHIgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nO1xuICB2YXIgb3V0cHV0ID0gJyc7XG4gIHZhciBjaHIxLCBjaHIyLCBjaHIzO1xuICB2YXIgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDtcbiAgdmFyIGkgPSAwO1xuICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoL1teQS1aYS16MC05XFwrXFwvXFw9XS9nLCAnJyk7XG4gIHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKSB7XG4gICAgZW5jMSA9IF9rZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgZW5jMiA9IF9rZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgZW5jMyA9IF9rZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgZW5jNCA9IF9rZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgY2hyMSA9IChlbmMxIDw8IDIpIHwgKGVuYzIgPj4gNCk7XG4gICAgY2hyMiA9ICgoZW5jMiAmIDE1KSA8PCA0KSB8IChlbmMzID4+IDIpO1xuICAgIGNocjMgPSAoKGVuYzMgJiAzKSA8PCA2KSB8IGVuYzQ7XG4gICAgb3V0cHV0ID0gb3V0cHV0ICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaHIxKTtcbiAgICBpZiAoZW5jMyAhPT0gNjQpIHtcbiAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMik7XG4gICAgfVxuICAgIGlmIChlbmM0ICE9PSA2NCkge1xuICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaHIzKTtcbiAgICB9XG4gIH1cbiAgLy8gb3V0cHV0ID0gdXRmOF9kZWNvZGUob3V0cHV0KTtcbiAgcmV0dXJuIG91dHB1dDtcbn1cblxuLy8gZnVuY3Rpb24gdXRmOF9kZWNvZGUodXRmdGV4dCkge1xuLy8gICB2YXIgc3RyaW5nID0gXCJcIjtcbi8vICAgdmFyIGkgPSAwO1xuLy8gICB2YXIgYyA9IDA7XG4vLyAgIHZhciBjMSA9IDA7XG4vLyAgIHZhciBjMiA9IDA7XG4vLyAgIHdoaWxlICggaSA8IHV0ZnRleHQubGVuZ3RoICkge1xuLy8gICAgIGMgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSk7XG4vLyAgICAgaWYgKGMgPCAxMjgpIHtcbi8vICAgICAgIHN0cmluZyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuLy8gICAgICAgaSsrO1xuLy8gICAgIH0gZWxzZSBpZigoYyA+IDE5MSkgJiYgKGMgPCAyMjQpKSB7XG4vLyAgICAgICBjMiA9IHV0ZnRleHQuY2hhckNvZGVBdChpKzEpO1xuLy8gICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMzEpIDw8IDYpIHwgKGMyICYgNjMpKTtcbi8vICAgICAgIGkgKz0gMjtcbi8vICAgICB9IGVsc2Uge1xuLy8gICAgICAgYzIgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSsxKTtcbi8vICAgICAgIHZhciBjMyA9IHV0ZnRleHQuY2hhckNvZGVBdChpKzIpO1xuLy8gICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpO1xuLy8gICAgICAgaSArPSAzO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gICByZXR1cm4gc3RyaW5nO1xuLy8gfVxuXG4iXX0=
