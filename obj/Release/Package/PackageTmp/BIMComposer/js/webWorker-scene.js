self.onmessage = function (e) {
    var category;
    var cateInfo = JSON.parse(e.data);
    var url = cateInfo.url;
    var formData = new FormData();
    formData.append('ProjectID', cateInfo.ProjectID);
    formData.append('ModelID', cateInfo.ModelID);
    formData.append('VersionNO', cateInfo.VersionNO);
    formData.append('Levels', cateInfo.Levels);
    formData.append('BaseViewID', cateInfo.BaseViewID);
    formData.append('CategoryID', cateInfo.CategoryID);
    postJSON(url, formData).then(function (data) {
        var geoCategory = [];
        var elementMesh = [];
        var rawCategory = JSON.parse(data);
        for (var _i = 0, _a = rawCategory.Blocks; _i < _a.length; _i++) {
            var block = _a[_i];
            var ctm = block.Content.toString();
            var ctmArr = decode(ctm);
            var geo = {
                blockId: block.ID,
                content: ctmArr,
            };
            geoCategory.push(geo);
        }
        var category = {
            modelIdAndViewId: cateInfo.ModelID + '^' + cateInfo.BaseViewID,
            geometries: geoCategory,
            batchName: rawCategory.BatchName,
            elements: rawCategory.Elements
        };
        data = null;
        var msg = { obj: category };
        self.postMessage(msg);
    });
};
function postJSON(_url, _formData) {
    return new Promise(function (resolve, reject) {
        var request = new XMLHttpRequest();
        request.open('POST', _url, true);
        request.onreadystatechange = function () {
            if (this.readyState === 4 && (this.status === 200 || this.status === 0)) {
                try {
                    if (request.responseText.indexOf('schemas.microsoft.com') >= 0) {
                        var parser = new DOMParser();
                        var resultDoc = parser.parseFromString(request.responseText, 'text/xml');
                        var resText = request.responseText.split('Serialization/">')[1].split('</string')[0];
                        resolve(resText);
                    }
                    else {
                        resolve(request.responseText);
                    }
                }
                catch (e) {
                    reject({
                        e: e,
                        url: _url
                    });
                }
            }
        };
        request.send(_formData);
    });
}
function Str2Bytes(str) {
    var pos = 0;
    var len = str.length;
    if (len % 2 !== 0) {
        return null;
    }
    len /= 2;
    var hexA = new Array();
    for (var i = 0; i < len; i++) {
        var s = str.substr(pos, 2);
        var v = parseInt(s, 16);
        hexA.push(v);
        pos += 2;
    }
    return hexA;
}
function decode(input) {
    var _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    var output = '';
    var chr1, chr2, chr3;
    var enc1, enc2, enc3, enc4;
    var i = 0;
    input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');
    while (i < input.length) {
        enc1 = _keyStr.indexOf(input.charAt(i++));
        enc2 = _keyStr.indexOf(input.charAt(i++));
        enc3 = _keyStr.indexOf(input.charAt(i++));
        enc4 = _keyStr.indexOf(input.charAt(i++));
        chr1 = (enc1 << 2) | (enc2 >> 4);
        chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
        chr3 = ((enc3 & 3) << 6) | enc4;
        output = output + String.fromCharCode(chr1);
        if (enc3 !== 64) {
            output = output + String.fromCharCode(chr2);
        }
        if (enc4 !== 64) {
            output = output + String.fromCharCode(chr3);
        }
    }
    return output;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmtzL2JpbS9zZXJ2aWNlcy93ZWJXb3JrZXItc2NlbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBMEJBLElBQUksQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDO0lBQzFCLElBQUksUUFBYSxDQUFDO0lBQ2xCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xDLElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUM7SUFDdkIsSUFBSSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztJQUM5QixRQUFRLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDakQsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzdDLFFBQVEsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqRCxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0MsUUFBUSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ25ELFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNuRCxRQUFRLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLElBQUk7UUFDaEMsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQVcsQ0FBQyxDQUFDO1FBQzFDLEdBQUcsQ0FBQyxDQUFjLFVBQWtCLEVBQWxCLEtBQUEsV0FBVyxDQUFDLE1BQU0s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RyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN4QyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDaEMsTUFBTSxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLE1BQU0sR0FBRyxNQUFNLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEIsTUFBTSxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNoQixDQUFDIiwiZmlsZSI6ImFwcC9mcmFtZXdvcmtzL2JpbS9zZXJ2aWNlcy93ZWJXb3JrZXItc2NlbmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL+eUqOadpeWkhOeQhuWkmue6v+eoi+mXrumimFxuLy8gKHNlbGYgYXMgYW55KS5pbXBvcnRTY3JpcHRzKCdodHRwOi8vbG9jYWxob3N0OjU1NTUvbm9kZV9tb2R1bGVzL3RocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvY3RtLy9jdG0uanMnKTtcbi8vIChzZWxmIGFzIGFueSkuaW1wb3J0U2NyaXB0cygnaHR0cDovL2xvY2FsaG9zdDo1NTU1L25vZGVfbW9kdWxlcy90aHJlZS9leGFtcGxlcy9qcy9sb2FkZXJzL2N0bS8vbHptYS5qcycpO1xuLy8gKHNlbGYgYXMgYW55KS5pbXBvcnRTY3JpcHRzKCdodHRwOi8vbG9jYWxob3N0OjU1NTUvbm9kZV9tb2R1bGVzL3RocmVlL2V4YW1wbGVzL2pzLy9odG1sNS1mb3JtZGF0YS1wb2x5ZmlsbGwuanMnKTtcbmRlY2xhcmUgdmFyIENUTTtcblxudHlwZSBFbGVtZW50VHlwZSA9IHtcbiAgbW9kZWxJZDogc3RyaW5nLFxuICBiYXRjaEluZGV4OiBudW1iZXIsXG4gIGJhdGNoTmFtZTogc3RyaW5nLFxuICBzY2VuZUluZGV4OiBudW1iZXIsXG4gIGZhbWlseUlkOiBzdHJpbmcsXG4gIGZhbWlseU5hbWU6IHN0cmluZyxcbiAgbGV2ZWxJZDogc3RyaW5nLFxuICB0eXBlSWQ6IHN0cmluZyxcbiAgdHlwZU5hbWU6IHN0cmluZyxcbiAgdHJhbnNmb3JtOiBzdHJpbmcsXG4gIGVsZW1lbnRJZDogbnVtYmVyLFxuICBoYXNCcm90aGVyczogYm9vbGVhbixcbiAgcHJvcGVydGllczogYW55O1xuICBoYXNUcmFuc3BhcmVudDogYm9vbGVhbixcbiAgZ2VvbWV0cnlQb3NpdGlvbjogc3RyaW5nLFxuICBtYXRlcmlhbElkOiBzdHJpbmcsXG4gIHBhcnRzOiBhbnlbXVxufTtcblxuc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuICBsZXQgY2F0ZWdvcnk6IGFueTtcbiAgbGV0IGNhdGVJbmZvID0gSlNPTi5wYXJzZShlLmRhdGEpO1xuICBsZXQgdXJsID0gY2F0ZUluZm8udXJsO1xuICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgZm9ybURhdGEuYXBwZW5kKCdQcm9qZWN0SUQnLCBjYXRlSW5mby5Qcm9qZWN0SUQpO1xuICBmb3JtRGF0YS5hcHBlbmQoJ01vZGVsSUQnLCBjYXRlSW5mby5Nb2RlbElEKTtcbiAgZm9ybURhdGEuYXBwZW5kKCdWZXJzaW9uTk8nLCBjYXRlSW5mby5WZXJzaW9uTk8pO1xuICBmb3JtRGF0YS5hcHBlbmQoJ0xldmVscycsIGNhdGVJbmZvLkxldmVscyk7XG4gIGZvcm1EYXRhLmFwcGVuZCgnQmFzZVZpZXdJRCcsIGNhdGVJbmZvLkJhc2VWaWV3SUQpO1xuICBmb3JtRGF0YS5hcHBlbmQoJ0NhdGVnb3J5SUQnLCBjYXRlSW5mby5DYXRlZ29yeUlEKTtcbiAgcG9zdEpTT04odXJsLCBmb3JtRGF0YSkudGhlbigoZGF0YSkgPT4ge1xuICAgIGxldCBnZW9DYXRlZ29yeSA9IFtdO1xuICAgIGxldCBlbGVtZW50TWVzaCA9IFtdO1xuICAgIGxldCByYXdDYXRlZ29yeSA9IEpTT04ucGFyc2UoZGF0YSBhcyBhbnkpO1xuICAgIGZvciAobGV0IGJsb2NrIG9mIHJhd0NhdGVnb3J5LkJsb2Nrcykge1xuXG4gICAgICBsZXQgY3RtID0gYmxvY2suQ29udGVudC50b1N0cmluZygpO1xuICAgICAgbGV0IGN0bUFyciA9IGRlY29kZShjdG0pO1xuICAgICAgLy8gY3RtID0gJyc7XG4gICAgICAvLyBmb3IgKGxldCBpbmRleCBvZiBjdG1BcnIpIHtcbiAgICAgIC8vICAgbGV0IGNoYXJjb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChpbmRleCkpO1xuICAgICAgLy8gICBjdG0gKz0gY2hhcmNvZGU7XG4gICAgICAvLyB9XG4gICAgICAvLyBsZXQgZmlsZSA9IG5ldyBDVE0uRmlsZShuZXcgQ1RNLlN0cmVhbShjdG0pKTtcbiAgICAgIC8vIGdlb0NhdGVnb3J5LnNldChibG9jay5JRCwgY3JlYXRlR2VvbWV0cnlGcm9tQ1RNKGZpbGUpKTtcbiAgICAgIGxldCBnZW8gPSB7XG4gICAgICAgIGJsb2NrSWQ6IGJsb2NrLklELFxuICAgICAgICBjYXRlZ29yeWJ1ZmZlcjogY3RtQXJyLC8vY3JlYXRlR2VvbWV0cnlGcm9tQ1RNKGZpbGUpLFxuICAgICAgfTtcbiAgICAgIGdlb0NhdGVnb3J5LnB1c2goZ2VvKTtcbiAgICB9XG4gICAgbGV0IGNhdGVnb3J5ID0ge1xuICAgICAgbW9kZWxJZEFuZFZpZXdJZDogY2F0ZUluZm8uTW9kZWxJRCArICdeJyArIGNhdGVJbmZvLkJhc2VWaWV3SUQsXG4gICAgICBnZW9tZXRyaWVzOiBnZW9DYXRlZ29yeSxcbiAgICAgIGJhdGNoTmFtZTogcmF3Q2F0ZWdvcnkuQmF0Y2hOYW1lLFxuICAgICAgZWxlbWVudHM6IHJhd0NhdGVnb3J5LkVsZW1lbnRzXG4gICAgfTtcbiAgICBkYXRhID0gbnVsbDtcbiAgICBsZXQgbXNnID0ge29iajogY2F0ZWdvcnl9O1xuICAgIChzZWxmIGFzIGFueSkucG9zdE1lc3NhZ2UobXNnKTtcbiAgfSk7XG5cbn07XG5cbi8vcG9zdFxuZnVuY3Rpb24gcG9zdEpTT04oX3VybCwgX2Zvcm1EYXRhKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICByZXF1ZXN0Lm9wZW4oJ1BPU1QnLCBfdXJsLCB0cnVlKTtcbiAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IDQgJiYgKHRoaXMuc3RhdHVzID09PSAyMDAgfHwgdGhpcy5zdGF0dXMgPT09IDApKSB7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAocmVxdWVzdC5yZXNwb25zZVRleHQuaW5kZXhPZignc2NoZW1hcy5taWNyb3NvZnQuY29tJykgPj0gMCkge1xuICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICAgIHZhciByZXN1bHREb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHJlcXVlc3QucmVzcG9uc2VUZXh0LCAndGV4dC94bWwnKTtcbiAgICAgICAgICAgIHZhciByZXNUZXh0ID0gcmVxdWVzdC5yZXNwb25zZVRleHQuc3BsaXQoJ1NlcmlhbGl6YXRpb24vXCI+JylbMV0uc3BsaXQoJzwvc3RyaW5nJylbMF07XG4gICAgICAgICAgICByZXNvbHZlKHJlc1RleHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcblxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICBlOiBlLFxuICAgICAgICAgICAgdXJsOiBfdXJsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHJlcXVlc3Quc2VuZChfZm9ybURhdGEpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gU3RyMkJ5dGVzKHN0cikge1xuICBsZXQgcG9zID0gMDtcbiAgbGV0IGxlbiA9IHN0ci5sZW5ndGg7XG4gIGlmIChsZW4gJSAyICE9PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgbGVuIC89IDI7XG4gIGxldCBoZXhBID0gbmV3IEFycmF5KCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICBsZXQgcyA9IHN0ci5zdWJzdHIocG9zLCAyKTtcbiAgICBsZXQgdiA9IHBhcnNlSW50KHMsIDE2KTtcbiAgICBoZXhBLnB1c2godik7XG4gICAgcG9zICs9IDI7XG4gIH1cbiAgcmV0dXJuIGhleEE7XG59XG5cbmZ1bmN0aW9uIGRlY29kZShpbnB1dCkge1xuICBsZXQgX2tleVN0ciA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSc7XG4gIHZhciBvdXRwdXQgPSAnJztcbiAgdmFyIGNocjEsIGNocjIsIGNocjM7XG4gIHZhciBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0O1xuICB2YXIgaSA9IDA7XG4gIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcXCtcXC9cXD1dL2csICcnKTtcbiAgd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpIHtcbiAgICBlbmMxID0gX2tleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICBlbmMyID0gX2tleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICBlbmMzID0gX2tleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICBlbmM0ID0gX2tleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICBjaHIxID0gKGVuYzEgPDwgMikgfCAoZW5jMiA+PiA0KTtcbiAgICBjaHIyID0gKChlbmMyICYgMTUpIDw8IDQpIHwgKGVuYzMgPj4gMik7XG4gICAgY2hyMyA9ICgoZW5jMyAmIDMpIDw8IDYpIHwgZW5jNDtcbiAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjEpO1xuICAgIGlmIChlbmMzICE9PSA2NCkge1xuICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaHIyKTtcbiAgICB9XG4gICAgaWYgKGVuYzQgIT09IDY0KSB7XG4gICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjMpO1xuICAgIH1cbiAgfVxuICAvLyBvdXRwdXQgPSB1dGY4X2RlY29kZShvdXRwdXQpO1xuICByZXR1cm4gb3V0cHV0O1xufVxuXG4vLyBmdW5jdGlvbiB1dGY4X2RlY29kZSh1dGZ0ZXh0KSB7XG4vLyAgIHZhciBzdHJpbmcgPSBcIlwiO1xuLy8gICB2YXIgaSA9IDA7XG4vLyAgIHZhciBjID0gMDtcbi8vICAgdmFyIGMxID0gMDtcbi8vICAgdmFyIGMyID0gMDtcbi8vICAgd2hpbGUgKCBpIDwgdXRmdGV4dC5sZW5ndGggKSB7XG4vLyAgICAgYyA9IHV0ZnRleHQuY2hhckNvZGVBdChpKTtcbi8vICAgICBpZiAoYyA8IDEyOCkge1xuLy8gICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4vLyAgICAgICBpKys7XG4vLyAgICAgfSBlbHNlIGlmKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHtcbi8vICAgICAgIGMyID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkrMSk7XG4vLyAgICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpO1xuLy8gICAgICAgaSArPSAyO1xuLy8gICAgIH0gZWxzZSB7XG4vLyAgICAgICBjMiA9IHV0ZnRleHQuY2hhckNvZGVBdChpKzEpO1xuLy8gICAgICAgdmFyIGMzID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkrMik7XG4vLyAgICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMiAmIDYzKSA8PCA2KSB8IChjMyAmIDYzKSk7XG4vLyAgICAgICBpICs9IDM7XG4vLyAgICAgfVxuLy8gICB9XG4vLyAgIHJldHVybiBzdHJpbmc7XG4vLyB9XG5cbiJdfQ==
